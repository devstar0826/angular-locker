/*! angular-locker v1.2.1 | (c) 2015 @tymondesigns | https://github.com/tymondesigns/angular-locker */
!function(t,e){"function"==typeof define&&define.amd?define(function(){return e(t.angular)}):"object"==typeof exports?module.exports=e(t.angular||window&&window.angular):e(t.angular)}(this,function(t){"use strict";t.module("angular-locker",[]).provider("locker",function(){var e=function(e,r){return t.isFunction(e)?e(r):e},r=function(t,e){return Object.keys(t).filter(function(r){return t[r]===e})[0]},i=function(e){return t.isDefined(e)&&null!==e},s=function(t){throw new Error("[angular-locker] "+t)},n={driver:"local",namespace:"locker",eventsEnabled:!0,separator:"."};return{config:n,$get:["$window","$rootScope","$parse",function(o,h,a){function u(i,a){this._registeredDrivers={local:o.localStorage,session:o.sessionStorage},this._resolveDriver=function(t){return this._registeredDrivers.hasOwnProperty(t)||s('The driver "'+t+'" was not found.'),this._registeredDrivers[t]},this._deriveDriver=function(t){return r(this._registeredDrivers,t)},this._driver=this._resolveDriver(i),this._namespace=a,this._eventsEnabled=n.eventsEnabled,this._separator=n.separator,this._watchers={},this._checkSupport=function(e){if(t.isUndefined(this._supported)){var r="l";try{this._resolveDriver(e||"local").setItem(r,r),this._resolveDriver(e||"local").removeItem(r),this._supported=!0}catch(i){this._supported=!1}}return this._supported},this._getPrefix=function(t){return this._namespace?this._namespace+this._separator+t:t},this._serialize=function(e){try{return t.toJson(e)}catch(r){return e}},this._unserialize=function(e){try{return t.fromJson(e)}catch(r){return e}},this._event=function(e,r){this._eventsEnabled&&h.$emit(e,t.extend(r,{driver:this._deriveDriver(this._driver),namespace:this._namespace}))},this._setItem=function(e,r){this._checkSupport()||s("The browser does not support localStorage");try{var i=this._getItem(e);this._driver.setItem(this._getPrefix(e),this._serialize(r)),this._exists(e)&&!t.equals(i,r)?this._event("locker.item.updated",{key:e,oldValue:i,newValue:r}):this._event("locker.item.added",{key:e,value:r})}catch(n){s(-1!==["QUOTA_EXCEEDED_ERR","NS_ERROR_DOM_QUOTA_REACHED","QuotaExceededError"].indexOf(n.name)?"The browser storage quota has been exceeded":'Could not add item with key "'+e+'"')}},this._getItem=function(t){return this._checkSupport()||s("The browser does not support localStorage"),this._unserialize(this._driver.getItem(this._getPrefix(t)))},this._exists=function(t){return this._checkSupport()||s("The browser does not support localStorage"),this._driver.hasOwnProperty(this._getPrefix(e(t)))},this._removeItem=function(t){return this._checkSupport()||s("The browser does not support localStorage"),this._exists(t)?(this._driver.removeItem(this._getPrefix(t)),this._event("locker.item.forgotten",{key:t}),!0):!1}}return u.prototype={put:function(r,s){if(!r)return!1;if(r=e(r),t.isObject(r))t.forEach(r,function(t,e){this._setItem(e,t)},this);else{if(!i(s))return!1;this._setItem(r,e(s,this._getItem(r)))}return this},add:function(t,e){return this.has(t)?!1:(this.put(t,e),!0)},get:function(e,r){if(t.isArray(e)){var i={};return t.forEach(e,function(t){this.has(t)&&(i[t]=this._getItem(t))},this),i}return this.has(e)?this._getItem(e):2===arguments.length?r:void 0},has:function(t){return this._exists(t)},forget:function(r){return r=e(r),t.isArray(r)?r.map(this._removeItem,this):this._removeItem(r),this},pull:function(t,e){var r=this.get(t,e);return this.forget(t),r},all:function(){var e={};return t.forEach(this._driver,function(t,r){var i=r.split(this._separator);i.length>1&&i[0]===this._namespace&&(i.splice(0,1),r=i.join(this._separator)),this.has(r)&&(e[r]=this.get(r))},this),e},clean:function(){return this.forget(Object.keys(this.all())),this},empty:function(){return this._driver.clear(),this},count:function(){return Object.keys(this.all()).length},bind:function(e,r,s){i(e.$eval(r))||(a(r).assign(e,this.get(r,s)),this.has(r)||this.put(r,s));var n=this;return this._watchers[r+e.$id]=e.$watch(r,function(t){i(t)&&n.put(r,t)},t.isObject(e[r])),this},unbind:function(t,e){a(e).assign(t,void 0),this.forget(e);var r=e+t.$id;return this._watchers[r]&&(this._watchers[r](),delete this._watchers[r]),this},driver:function(t){return this.instance(t,this._namespace)},getDriver:function(){return this._driver},namespace:function(t){return this.instance(this._deriveDriver(this._driver),t)},getNamespace:function(){return this._namespace},supported:function(t){return this._checkSupport(t)},instance:function(t,e){return new u(t,e)}},new u(n.driver,n.namespace)}]}})});
//# sourceMappingURL=angular-locker.min.js.map